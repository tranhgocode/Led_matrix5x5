#ifndef MATRIX_ANIMATION_H
#define MATRIX_ANIMATION_H

#include <Arduino.h>

class MatrixAnimation {
  private:
    // Kết nối chân
    int _shPin;  // Shift Clock (SH)
    int _dsPin;  // Data Serial (DS)
    int _stPin;  // Storage Clock (ST)
    int _rowPins[5];  // Chân hàng
    
    // Mẫu ký tự cho A-Z (ma trận 5x5)
    const byte _chu[26][5] = {
      {0x04,0x0a,0x1f,0x11,0x11}, //A 
      {0x1c,0x12,0x1c,0x12,0x1c}, //B
      {0x0e,0x11,0x10,0x11,0x0e}, //C
      {0x1c,0x12,0x12,0x12,0x1c}, //D
      {0x1e,0x10,0x1e,0x10,0x1e}, //E
      {0x1e,0x10,0x1e,0x10,0x10}, //F
      {0x0e,0x10,0x17,0x11,0x0e}, //G
      {0x11,0x11,0x1f,0x11,0x11}, //H
      {0x0e,0x04,0x04,0x04,0x0e}, //I
      {0x07,0x02,0x02,0x12,0x0c}, //J
      {0x12,0x14,0x18,0x14,0x12}, //K
      {0x10,0x10,0x10,0x10,0x1e}, //L
      {0x11,0x1b,0x15,0x11,0x11}, //M
      {0x11,0x19,0x15,0x13,0x11}, //N
      {0x1f,0x11,0x11,0x11,0x1f}, //O
      {0x1c,0x12,0x1c,0x10,0x10}, //P
      {0x0e,0x11,0x15,0x13,0x0f}, //Q
      {0x1c,0x12,0x1c,0x14,0x12}, //R
      {0x0e,0x10,0x0e,0x01,0x1e}, //S
      {0x1f,0x04,0x04,0x04,0x04}, //T
      {0x11,0x11,0x11,0x11,0x0e}, //U
      {0x11,0x11,0x11,0x0a,0x04}, //V
      {0x11,0x11,0x15,0x15,0x0A}, //W
      {0x11,0x0a,0x04,0x0a,0x11}, //X
      {0x11,0x0A,0x04,0x04,0x04}, //Y
      {0x1f,0x02,0x04,0x08,0x1f}, //Z
    };
    
    // Các hàm hỗ trợ
    void hienthi(byte leftMatrix[], byte rightMatrix[]);
    String InHoa(String text);
    int chuanBiDuLieuVanBan(String text, byte displayData[][200]);
    void capNhatDuLieuMaTran(byte displayData[][200], int shift, int totalCols, byte leftMatrix[], byte rightMatrix[]);
    void hienThiKhungHinh(byte leftMatrix[], byte rightMatrix[], int duration);
    int createTextBuffer(String text, byte fullBuffer[][5]);
    void displayTextFrame(byte fullBuffer[][5], int startRow, int totalRows);
    
  public:
    // Hàm khởi tạo
    MatrixAnimation(int shPin, int dsPin, int stPin, int row1, int row2, int row3, int row4, int row5);
    
    // Khởi tạo các chân
    void begin();
    
    // Các phương thức hoạt ảnh
    void scrollStrNgang(String text, int speed = 100);
    void scrollStrDoc(String text, int speed = 500);
    void LedXoay(int cycles = 1, int speed = 50);
    void randomFlicker(int duration = 2000, int flickerRate = 10);
    void randomPixelFlicker(int duration = 2000, int density = 5);
    
    // Thêm các hoạt ảnh tùy chỉnh của bạn
    // void hieuUngSong(int cycles = 3, int speed = 100);
    // void hieuUngMua(int duration = 3000, int density = 2);
};
